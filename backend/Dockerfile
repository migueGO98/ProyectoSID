FROM eclipse-temurin:17.0.11_9-jdk-alpine AS build

WORKDIR /app

# Copiar documentaci贸n de la API para OpenAPI Generator
COPY api-sid.yml .

WORKDIR /app/backend

# Copiar los archivos necesarios para instalar las dependencias
COPY pom.xml mvnw mvnw.cmd ./
COPY .mvn .mvn
COPY api-sid.yml .

# Descargar todas las dependencias sin construir el archivo JAR final
RUN ./mvnw dependency:go-offline

# Copiar el c贸digo fuente
COPY src ./src

# Compilar, testear y empaquetar la aplicaci贸n
RUN ./mvnw clean package



# Crear una imagen con la aplicaci贸n empaquetada
FROM eclipse-temurin:17.0.11_9-jre-alpine
WORKDIR /app
EXPOSE 8080
COPY --from=build /app/backend/target/*.jar ./app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]